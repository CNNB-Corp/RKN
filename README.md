# RKN

`RKN.ps1` — минимальный PowerShell-скрипт с меню, который:

- сам подбирает рабочую DNS-инфраструктуру из списка кандидатов;
- применяет настройки для активных сетевых адаптеров;
- проверяет доступность Discord/YouTube через HTTP-пинг;
- умеет быстро включать/выключать и показывать статус;
- поддерживает базовые и гибкие настройки.

## Быстрый старт

1. Откройте PowerShell от имени администратора.
2. Перейдите в каталог проекта.
3. Разрешите выполнение локальных скриптов (однократно на текущую сессию):

```powershell
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
```

4. Запустите скрипт:

```powershell
./RKN.ps1
```

## Запуск через .exe

Если хотите запускать RKN через файл `RKN.exe`, используйте готовый лаунчер:

1. Перейдите в папку `launcher`.
2. Соберите `RKN.exe`:

```cmd
build.cmd
```

> Скрипт сборки рассчитан на стандартный `csc.exe` из .NET Framework (C# 5), поэтому лаунчер написан без интерполяции строк.

3. Скопируйте `RKN.exe` в корень проекта рядом с `RKN.ps1`.
4. Запускайте `RKN.exe` (скрипт будет стартовать автоматически).

## Возможные проблемы

### Ошибка парсинга с «Непредвиденная лексема»

Если PowerShell ругается на неожиданные токены, убедитесь, что файл сохранен в UTF-8 с BOM (подписью). 
В репозитории файл уже записан в UTF-8 BOM. Если вы пересохранили его через редактор, верните кодировку.

Также можно запускать так:

```powershell
powershell.exe -NoProfile -ExecutionPolicy Bypass -File .\\RKN.ps1
```

## Настройки

- Базовые настройки доступны из меню.
- Гибкие настройки открывают `config/rkn.settings.json` в блокноте.
- В `Advanced.HttpTestUrls` можно заменить проверяемые URL, если нужны другие сервисы.
- Параметр `Advanced.HttpRequireAll` определяет логику проверки: `false` — достаточно успеха хотя бы по одному URL.

> Скрипт сохраняет предыдущие DNS-настройки в `config/rkn.state.json`, чтобы корректно восстановить их при остановке.
